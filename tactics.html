<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS2 Dust2 äº¤äº’æˆ˜æœ¯æ¿</title>
    <style>
        :root {
            --bg-dark: #1b1b1b;
            --panel-bg: #2d2d2d;
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --accent: #d39c31; /* CS2 Gold */
            --border: #404040;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* é˜²æ­¢æ‹–æ‹½æ—¶é€‰ä¸­æ–‡å­— */
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        header {
            background-color: var(--panel-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            z-index: 10;
        }

        .tactic-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--accent);
            color: var(--text-main);
            font-size: 1.5rem;
            text-align: center;
            width: 60%;
            padding: 5px;
            outline: none;
            font-weight: bold;
            transition: border-color 0.3s;
        }

        .tactic-input:focus {
            border-bottom-color: #fff;
        }

        .tactic-input::placeholder {
            color: var(--text-muted);
            opacity: 0.5;
        }

        /* ä¸»å¸ƒå±€ */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* å·¦ä¾§è¾¹æ ï¼šé˜Ÿå‘˜æ§åˆ¶ */
        .sidebar {
            width: 300px;
            background-color: #252525;
            border-right: 1px solid var(--border);
            padding: 20px;
            overflow-y: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar h3 {
            margin: 0 0 10px 0;
            color: var(--accent);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .section-group {
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
        }

        .player-row {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .color-picker {
            width: 30px;
            height: 30px;
            border: none;
            padding: 0;
            background: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .input-field {
            background: transparent;
            border: 1px solid var(--border);
            color: white;
            padding: 6px;
            border-radius: 4px;
            width: 100%;
            font-size: 0.9rem;
        }
        
        .input-field:focus {
            border-color: var(--accent);
            outline: none;
        }

        .btn-reset {
            background-color: #c0392b;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: background 0.2s;
        }

        .btn-reset:hover {
            background-color: #e74c3c;
        }

        /* å³ä¾§ï¼šåœ°å›¾åŒºåŸŸ */
        .maps-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            background-color: #151515;
        }

        .map-section {
            position: relative;
            width: 100%;
            max-width: 800px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢å›¾ç‰‡è¿‡å¤§ */
            border: 2px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .map-header {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.85);
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            border-left: 3px solid var(--accent);
            z-index: 5;
            pointer-events: none;
        }

        .map-wrapper {
            position: relative;
            width: 100%;
            /* ä¿æŒå®½é«˜æ¯” */
            aspect-ratio: 1024 / 1024;
            background: #000;
        }

        .game-map {
            width: 100%;
            height: 100%;
            object-fit: contain; /* ä¿è¯åœ°å›¾å®Œæ•´æ˜¾ç¤º */
            display: block;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ° wrapper */
        }

        /* é˜Ÿå‘˜ Token */
        .token {
            position: absolute;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #fff;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 11px;
            color: #fff; /* æ–‡å­—é¢œè‰²ï¼Œé€šå¸¸é…åˆ text-shadow */
            text-shadow: 0 1px 2px rgba(0,0,0,1);
            cursor: grab;
            z-index: 100;
            transform: translate(-50%, -50%); /* å±…ä¸­å®šä½ */
            transition: transform 0.1s;
        }

        .token:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 200;
        }
        
        .token::after {
            content: '';
            position: absolute;
            top: -4px; left: -4px; right: -4px; bottom: -4px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
        }

    </style>
</head>
<body>

    <header>
        <input type="text" class="tactic-input" placeholder="è¾“å…¥æˆ˜æœ¯åç§° (ä¾‹: Dust2 Aå¤§å¿«æ”»)" value="Dust2 Default Setup">
    </header>

    <div class="main-content">
        <!-- æ§åˆ¶é¢æ¿ -->
        <aside class="sidebar">
            
            <div class="section-group">
                <h3>åœ°å›¾è®¾ç½®</h3>
                <div style="font-size: 0.8rem; color: #aaa; margin-bottom: 5px;">åœ°å›¾å›¾ç‰‡ URL:</div>
                <input type="text" id="map-url-input" class="input-field" value="https://github.com/JerryZJJJ/cs2/raw/main/dust2_game_radar_1b998342f2.webp">
                <div style="margin-top:5px; font-size: 0.75rem; color: #666;">
                    * å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå¯ä»¥å°è¯•ç²˜è´´å…¶ä»–å›¾ç‰‡ç½‘å€ã€‚
                </div>
            </div>

            <div class="section-group">
                <h3>é˜Ÿå‘˜ (T / CT)</h3>
                <div id="player-controls">
                    <!-- JS ä¼šåœ¨è¿™é‡Œç”Ÿæˆè¾“å…¥æ¡† -->
                </div>
            </div>
            
            <div style="margin-top:auto; color: #666; font-size: 0.8rem; margin-bottom: 20px;">
                <p>ğŸ’¡ æç¤ºï¼š</p>
                <ul style="padding-left: 20px;">
                    <li>è¿™æ˜¯2Då¹³é¢é›·è¾¾å›¾ï¼Œä½ç½®æ›´ç²¾å‡†ã€‚</li>
                    <li>ä¿®æ”¹ä¸Šæ–¹URLå¯æ›´æ¢ä¸ºä»»ä½•åœ°å›¾ã€‚</li>
                </ul>
            </div>

            <button class="btn-reset" onclick="resetAllPositions()">é‡ç½®ä½ç½®</button>
        </aside>

        <!-- åœ°å›¾åŒºåŸŸ -->
        <main class="maps-container">
            
            <!-- åœ°å›¾ 1ï¼šåˆå§‹ç«™ä½ -->
            <div class="map-section">
                <div class="map-header">Phase 1: åˆå§‹ç«™ä½ / Freeze Time</div>
                <div class="map-wrapper" id="map-phase-1">
                    <img src="" class="game-map map-image" alt="Map Radar">
                    <!-- Tokens will be injected here -->
                </div>
            </div>

            <!-- åœ°å›¾ 2ï¼šä¸­æœŸ/æ®‹å±€ -->
            <div class="map-section">
                <div class="map-header">Phase 2: ä¸­æœŸåšå¼ˆ / Execution</div>
                <div class="map-wrapper" id="map-phase-2">
                    <img src="" class="game-map map-image" alt="Map Radar">
                    <!-- Tokens will be injected here -->
                </div>
            </div>

        </main>
    </div>

    <script>
        // é…ç½®æ•°æ®
        const initialPlayers = [
            { id: 0, name: 'AWP', color: '#e74c3c' },    // çº¢è‰²
            { id: 1, name: 'ä¸»B', color: '#f1c40f' },  // é»„è‰²
            { id: 2, name: 'æ”¯æŒ1', color: '#3498db' },// è“è‰²
            { id: 3, name: 'ä¸»A', color: '#9b59b6' }, // ç´«è‰²
            { id: 4, name: 'æ”¯æŒ2', color: '#2ecc71' }     // ç»¿è‰²
        ];

        // çŠ¶æ€
        let players = JSON.parse(JSON.stringify(initialPlayers));

        // åˆå§‹åŒ–
        function init() {
            renderControls();
            setupMapUrlListener();
            renderTokens('map-phase-1');
            renderTokens('map-phase-2');
            
            // è§¦å‘ä¸€æ¬¡åœ°å›¾åŠ è½½
            updateMapImages(document.getElementById('map-url-input').value);
        }

        // ç›‘å¬åœ°å›¾URLå˜åŒ–
        function setupMapUrlListener() {
            const input = document.getElementById('map-url-input');
            input.addEventListener('input', (e) => {
                updateMapImages(e.target.value);
            });
        }

        function updateMapImages(url) {
            if (!url) return;
            document.querySelectorAll('.map-image').forEach(img => {
                img.src = url;
            });
        }

        // æ¸²æŸ“å·¦ä¾§æ§åˆ¶æ 
        function renderControls() {
            const container = document.getElementById('player-controls');
            container.innerHTML = '';

            players.forEach((player, index) => {
                const row = document.createElement('div');
                row.className = 'player-row';

                // é¢œè‰²é€‰æ‹©å™¨
                const colorInput = document.createElement('input');
                colorInput.type = 'color';
                colorInput.className = 'color-picker';
                colorInput.value = player.color;
                colorInput.addEventListener('input', (e) => updatePlayerColor(index, e.target.value));

                // åå­—è¾“å…¥æ¡†
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'input-field';
                nameInput.value = player.name;
                nameInput.addEventListener('input', (e) => updatePlayerName(index, e.target.value));

                row.appendChild(colorInput);
                row.appendChild(nameInput);
                container.appendChild(row);
            });
        }

        // åœ¨åœ°å›¾ä¸Šç”Ÿæˆ Token
        function renderTokens(containerId) {
            const container = document.getElementById(containerId);
            
            players.forEach((player, index) => {
                const token = document.createElement('div');
                token.className = `token token-id-${index}`;
                token.dataset.id = index;
                
                // åˆå§‹æ ·å¼
                updateTokenVisuals(token, player);

                // åˆå§‹ä½ç½®ï¼šé»˜è®¤æ”¾åœ¨Tå®¶é™„è¿‘ (Dust2 T spawn å¤§æ¦‚åœ¨å³ä¸Šæˆ–è€…å³è¾¹ï¼Œè¿™é‡Œéšä¾¿ç»™ä¸ªåˆå§‹å€¼)
                const startX = 80 - (index * 5); 
                const startY = 20 + (index * 5);
                
                token.style.left = `${startX}%`;
                token.style.top = `${startY}%`;

                // ç»‘å®šæ‹–æ‹½
                enableDrag(token, container);

                container.appendChild(token);
            });
        }

        // æ›´æ–°é€»è¾‘
        function applyTokenLabel(token, name) {
            const text = (name || '').toUpperCase();
            let fontSize = 11;
            if (text.length >= 4) {
                fontSize = 9;
            } else if (text.length === 3) {
                fontSize = 10;
            }
            token.innerText = text;
            token.style.fontSize = `${fontSize}px`;
        }

        function updatePlayerName(index, newName) {
            players[index].name = newName;
            document.querySelectorAll(`.token-id-${index}`).forEach(token => {
                applyTokenLabel(token, newName);
            });
        }

        function updatePlayerColor(index, newColor) {
            players[index].color = newColor;
            document.querySelectorAll(`.token-id-${index}`).forEach(token => {
                token.style.backgroundColor = newColor;
            });
        }

        function updateTokenVisuals(element, playerData) {
            element.style.backgroundColor = playerData.color;
            applyTokenLabel(element, playerData.name);
        }

        // æ ¸å¿ƒæ‹–æ‹½é€»è¾‘
        function enableDrag(element, container) {
            let isDragging = false;
            
            const startDrag = (e) => {
                isDragging = true;
                element.style.zIndex = 1000;
            };

            const endDrag = () => {
                isDragging = false;
                element.style.zIndex = 100;
            };

            const doDrag = (e) => {
                if (!isDragging) return;
                e.preventDefault();

                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                const rect = container.getBoundingClientRect();

                let x = clientX - rect.left;
                let y = clientY - rect.top;

                x = Math.max(0, Math.min(x, rect.width));
                y = Math.max(0, Math.min(y, rect.height));

                const xPercent = (x / rect.width) * 100;
                const yPercent = (y / rect.height) * 100;

                element.style.left = `${xPercent}%`;
                element.style.top = `${yPercent}%`;
            };

            element.addEventListener('mousedown', startDrag);
            window.addEventListener('mouseup', endDrag);
            window.addEventListener('mousemove', doDrag);

            element.addEventListener('touchstart', startDrag, {passive: false});
            window.addEventListener('touchend', endDrag);
            window.addEventListener('touchmove', doDrag, {passive: false});
        }

        function resetAllPositions() {
            const allTokens = document.querySelectorAll('.token');
            allTokens.forEach(token => {
                const index = parseInt(token.dataset.id);
                token.style.left = `${80 - (index * 5)}%`;
                token.style.top = `${20 + (index * 5)}%`;
            });
        }

        init();

    </script>
</body>
</html>